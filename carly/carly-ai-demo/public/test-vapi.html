<!DOCTYPE html>
<html>
<head>
    <title>Vapi Test</title>
</head>
<body>
    <h1>Vapi Connection Test</h1>
    <button id="test-call">Test Call</button>
    <div id="status"></div>
    
    <script type="module">
        // Try to import Vapi from different CDNs
        let Vapi;
        try {
            // Try the official CDN first
            const module = await import('https://unpkg.com/@vapi-ai/web@latest/dist/index.js');
            Vapi = module.default || module.Vapi;
        } catch (e1) {
            try {
                // Try alternative CDN
                const module = await import('https://cdn.skypack.dev/@vapi-ai/web');
                Vapi = module.default || module.Vapi;
            } catch (e2) {
                document.getElementById('status').innerHTML = '‚ùå Failed to load Vapi SDK: ' + e2.message;
                console.error('Failed to load Vapi:', e1, e2);
                throw e2;
            }
        }
        
        console.log('Vapi loaded:', Vapi);
        
        const vapi = new Vapi('YOUR_VAPI_PUBLIC_KEY_HERE');
        const status = document.getElementById('status');
        
        vapi.on('call-start', () => {
            status.innerHTML = '‚úÖ Call started successfully!';
            console.log('Call started!');
        });
        
        vapi.on('error', (error) => {
            console.error('Detailed Vapi error:', error);
            console.error('Error type:', typeof error);
            console.error('Error keys:', Object.keys(error || {}));
            status.innerHTML = `‚ùå Error: ${JSON.stringify(error, null, 2)}`;
        });
        
        vapi.on('call-end', () => {
            status.innerHTML = 'üìû Call ended';
            console.log('Call ended');
        });
        
        // Make testCall available globally
        window.testCall = () => {
            status.innerHTML = 'üîÑ Starting call...';
            console.log('Attempting to start call...');
            try {
                // Try different configuration formats
                console.log('Trying method 1: assistantId only');
                vapi.start('YOUR_ASSISTANT_ID_HERE');
            } catch (error) {
                console.error('Method 1 failed:', error);
                try {
                    console.log('Trying method 2: assistant object');
                    vapi.start({
                        assistant: {
                            id: 'YOUR_ASSISTANT_ID_HERE'
                        }
                    });
                } catch (error2) {
                    console.error('Method 2 failed:', error2);
                    try {
                        console.log('Trying method 3: empty config');
                        vapi.start();
                    } catch (error3) {
                        console.error('All methods failed:', error3);
                        status.innerHTML = `‚ùå All methods failed. Last error: ${error3.message}`;
                    }
                }
            }
        };
        
        status.innerHTML = '‚úÖ Vapi loaded successfully. Ready to test!';
    </script>
    
    <script>
        document.getElementById('test-call').addEventListener('click', () => {
            if (window.testCall) {
                window.testCall();
            } else {
                document.getElementById('status').innerHTML = '‚ùå Test function not ready yet';
            }
        });
    </script>
</body>
</html>